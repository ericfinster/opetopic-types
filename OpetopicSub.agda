--
--  OpetopicMap.agda - Maps of opetopic types
--

open import Cubical.Foundations.Everything
open import Cubical.Data.Unit
open import Cubical.Data.Nat

open import Prelude
open import Opetopes
open import OpetopicCtx

module OpetopicSub where

  infixr 40 _â‡’_

  _â‡’_ : âˆ€ {â„“â‚€ â„“â‚ n} â†’ ğ•†Ctx â„“â‚€ n â†’ ğ•†Ctx â„“â‚ n
    â†’ Type (â„“-max â„“â‚€ â„“â‚)

  Frmâ‡’ : âˆ€ {â„“â‚€ â„“â‚ n} {Î“ : ğ•†Ctx â„“â‚€ n} {Î” : ğ•†Ctx â„“â‚ n} (Ïƒ : Î“ â‡’ Î”)
    â†’ {o : ğ’ª n} â†’ Frm Î“ o â†’ Frm Î” o
    
  Cnsâ‡’ : âˆ€ {â„“â‚€ â„“â‚ n} {Î“ : ğ•†Ctx â„“â‚€ n} {Î” : ğ•†Ctx â„“â‚ n} (Ïƒ : Î“ â‡’ Î”)
    â†’ {o : ğ’ª n} {Ï : ğ’« o} {f : Frm Î“ o}
    â†’ Cns Î“ f Ï â†’ Cns Î” (Frmâ‡’ Ïƒ f) Ï

  postulate

    Shp-Frmâ‡’ : âˆ€ {â„“â‚€ â„“â‚ n} {Î“ : ğ•†Ctx â„“â‚€ n} {Î” : ğ•†Ctx â„“â‚ n} (Ïƒ : Î“ â‡’ Î”)
      â†’ {o : ğ’ª n} {Ï : ğ’« o} {f : Frm Î“ o} (c : Cns Î“ f Ï) (p : Pos Ï)
      â†’ Frmâ‡’ Ïƒ (Shp Î“ c p) â†¦ Shp Î” (Cnsâ‡’ Ïƒ c) p
    {-# REWRITE Shp-Frmâ‡’ #-} 

    Î·â‡’ : âˆ€ {â„“â‚€ â„“â‚ n} {Î“ : ğ•†Ctx â„“â‚€ n} {Î” : ğ•†Ctx â„“â‚ n} (Ïƒ : Î“ â‡’ Î”)
      â†’ {o : ğ’ª n} (f : Frm Î“ o)
      â†’ Cnsâ‡’ Ïƒ (Î· Î“ f) â†¦ Î· Î” (Frmâ‡’ Ïƒ f)
    {-# REWRITE Î·â‡’ #-} 

    Î¼â‡’ : âˆ€ {â„“â‚€ â„“â‚ n} {Î“ : ğ•†Ctx â„“â‚€ n} {Î” : ğ•†Ctx â„“â‚ n} (Ïƒ : Î“ â‡’ Î”)
      â†’ {o : ğ’ª n} {f : Frm Î“ o}
      â†’ {Ï : ğ’« o} (c : Cns Î“ f Ï)
      â†’ {Î¹ : (p : Pos Ï) â†’ ğ’« (Typ Ï p)}
      â†’ (Îº : (p : Pos Ï) â†’ Cns Î“ (Shp Î“ c p) (Î¹ p))
      â†’ Cnsâ‡’ Ïƒ (Î¼ Î“ c Îº) â†¦ Î¼ Î” (Cnsâ‡’ Ïƒ c) (Î» p â†’ Cnsâ‡’ Ïƒ (Îº p))
    {-# REWRITE Î¼â‡’ #-}

  module _ {â„“â‚€ â„“â‚ n} {Î“â‚™ : ğ•†Ctx â„“â‚€ n} {Î”â‚™ : ğ•†Ctx â„“â‚ n}
           (Î“â‚›â‚™ : {o : ğ’ª n} â†’ Frm Î“â‚™ o â†’ Type â„“â‚€)
           (Î”â‚›â‚™ : {o : ğ’ª n} â†’ Frm Î”â‚™ o â†’ Type â„“â‚)
           (Ïƒâ‚™ : Î“â‚™ â‡’ Î”â‚™) (Ïƒâ‚›â‚™ : {o : ğ’ª n} {f : Frm Î“â‚™ o} â†’ Î“â‚›â‚™ f â†’ Î”â‚›â‚™ (Frmâ‡’ Ïƒâ‚™ f)) where

    WebFrmâ‡’ : {o : ğ’ª n} {Ï : ğ’« o}
      â†’ WebFrm Î“â‚™ Î“â‚›â‚™ Ï â†’ WebFrm Î”â‚™ Î”â‚›â‚™ Ï 
    WebFrmâ‡’ (f , x , c , y) = Frmâ‡’ Ïƒâ‚™ f , Ïƒâ‚›â‚™ x , Cnsâ‡’ Ïƒâ‚™ c , Î» p â†’ Ïƒâ‚›â‚™ (y p) 

    Webâ‡’ : {o : ğ’ª n} {Ï : ğ’« o}
      â†’ {Ï† : WebFrm Î“â‚™ Î“â‚›â‚™ Ï} {Ï„ : ğ’¯r Ï}
      â†’ Web Î“â‚™ Î“â‚›â‚™ Ï† Ï„ â†’ Web Î”â‚™ Î”â‚›â‚™ (WebFrmâ‡’ Ï†) Ï„ 
    Webâ‡’ (lf x) = lf (Ïƒâ‚›â‚™ x)
    Webâ‡’ (nd x c y d z Ïˆ) =
      nd (Ïƒâ‚›â‚™ x) (Cnsâ‡’ Ïƒâ‚™ c) (Ïƒâ‚›â‚™ âˆ˜ y) (Cnsâ‡’ Ïƒâ‚™ âˆ˜ d)
         (Î» p q â†’ Ïƒâ‚›â‚™ (z p q)) (Webâ‡’ âˆ˜ Ïˆ) 


  _â‡’_ {n = zero} _ _ = Lift Unit
  _â‡’_ {n = suc n} (Î“â‚™ , Î“â‚›â‚™) (Î”â‚™ , Î”â‚›â‚™) =
    Î£ (Î“â‚™ â‡’ Î”â‚™) (Î» Ïƒ â†’
     {o : ğ’ª n} {f : Frm Î“â‚™ o}
     â†’ Î“â‚›â‚™ f â†’ Î”â‚›â‚™ (Frmâ‡’ Ïƒ f))

  Frmâ‡’ {n = zero} Ïƒ _ = lift tt
  Frmâ‡’ {n = suc n} {Î“â‚™ , Î“â‚›â‚™} {Î”â‚™ , Î”â‚›â‚™} (Ïƒâ‚™ , Ïƒâ‚›â‚™) =
    WebFrmâ‡’ Î“â‚›â‚™ Î”â‚›â‚™ Ïƒâ‚™ Ïƒâ‚›â‚™

  Cnsâ‡’ {n = zero} _ _ = lift tt
  Cnsâ‡’ {n = suc n} {Î“â‚™ , Î“â‚›â‚™} {Î”â‚™ , Î”â‚›â‚™} (Ïƒâ‚™ , Ïƒâ‚›â‚™) =
    Webâ‡’ Î“â‚›â‚™ Î”â‚›â‚™ Ïƒâ‚™ Ïƒâ‚›â‚™
  
  --
  --  Composition
  --

  infixr 30 _âŠš_
  
  _âŠš_ : âˆ€ {â„“â‚€ â„“â‚ â„“â‚‚ n} {Î“ : ğ•†Ctx â„“â‚€ n} {Î” : ğ•†Ctx â„“â‚ n} {Î˜ : ğ•†Ctx â„“â‚‚ n}
    â†’ (Î” â‡’ Î˜) â†’ (Î“ â‡’ Î”) â†’ (Î“ â‡’ Î˜)

  postulate

    âŠš-Frm : âˆ€ {â„“â‚€ â„“â‚ â„“â‚‚ n} {Î“ : ğ•†Ctx â„“â‚€ n} {Î” : ğ•†Ctx â„“â‚ n} {Î˜ : ğ•†Ctx â„“â‚‚ n}
      â†’ (Ïƒ : Î” â‡’ Î˜) (Ï„ : Î“ â‡’ Î”) (o : ğ’ª n) (f : Frm Î“ o)
      â†’ Frmâ‡’ (Ïƒ âŠš Ï„) f â†¦ Frmâ‡’ Ïƒ (Frmâ‡’ Ï„ f)
    {-# REWRITE âŠš-Frm #-}

    âŠš-assoc : âˆ€ {â„“â‚€ â„“â‚ â„“â‚‚ â„“â‚ƒ n}
      â†’ {Î“ : ğ•†Ctx â„“â‚€ n} {Î” : ğ•†Ctx â„“â‚ n} {Î˜ : ğ•†Ctx â„“â‚‚ n} {W : ğ•†Ctx â„“â‚ƒ n}
      â†’ (Ïƒ : Î˜ â‡’ W) (Ï„ : Î” â‡’ Î˜) (Î³ : Î“ â‡’ Î”)
      â†’ (Ïƒ âŠš Ï„) âŠš Î³ â†¦ Ïƒ âŠš Ï„ âŠš Î³
    {-# REWRITE âŠš-assoc #-}

    -- And unit laws ...

  _âŠš_ {n = zero} Ïƒ Ï„ = lift tt
  _âŠš_ {n = suc n} {Î“â‚™ , Î“â‚›â‚™} {Î”â‚™ , Î”â‚›â‚™} {Î˜â‚™ , Î˜â‚›â‚™} (Ïƒâ‚™ , Ïƒâ‚›â‚™) (Ï„â‚™ , Ï„â‚›â‚™) =
    Ïƒâ‚™ âŠš Ï„â‚™ , Î» x â†’ Ïƒâ‚›â‚™ (Ï„â‚›â‚™ x)

