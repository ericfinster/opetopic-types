{-# OPTIONS --without-K --rewriting #-}

open import MiniHoTT
open import MiniUniverse
open import AbsoluteOpetopicTypes

module DependentOpetopicType where

  --
  --  The Universe of Dependent Opetopic Types
  --

  ğ•†â†“ : âˆ€ {â„“ : Level} {n : â„•} (â„“â†“ : Level) (X : ğ•† â„“ n)
    â†’ Set (â„“-max â„“ (â„“-suc â„“â†“))
    
  Frmâ†“ : âˆ€ {â„“ â„“â†“} {n : â„•} {X : ğ•† â„“ n} (Xâ†“ : ğ•†â†“ â„“â†“ X)
    (f : Frm X) â†’ Set â„“â†“

  postulate

    --
    -- Dependent Frame Decorations
    --
    
    FrmDecâ†“ : âˆ€ {â„“ â„“â†“} {n : â„•} {X : ğ•† â„“ n} 
      â†’ (Xâ†“ : ğ•†â†“ â„“â†“ X) {P : â„™}
      â†’ FrmDec X P â†’ Set â„“â†“

    âŠ¥-decâ†“ :  âˆ€ {â„“ â„“â†“} {n : â„•} {X : ğ•† â„“ n} 
      â†’ {Xâ†“ : ğ•†â†“ â„“â†“ X}
      â†’ FrmDecâ†“ Xâ†“ âŠ¥-dec
      
    âŠ¤-decâ†“ :  âˆ€ {â„“ â„“â†“} {n : â„•} {X : ğ•† â„“ n} 
      â†’ {Xâ†“ : ğ•†â†“ â„“â†“ X} {f : Frm X} (fâ†“ : Frmâ†“ Xâ†“ f)
      â†’ FrmDecâ†“ Xâ†“ (âŠ¤-dec f)
  
    âŠ”-decâ†“ : âˆ€ {â„“ â„“â†“} {n : â„•} {X : ğ•† â„“ n} 
      â†’ {Xâ†“ : ğ•†â†“ â„“â†“ X} {U V : â„™}
      â†’ {l : FrmDec X U} {r : FrmDec X V}
      â†’ FrmDecâ†“ Xâ†“ l â†’ FrmDecâ†“ Xâ†“ r
      â†’ FrmDecâ†“ Xâ†“ (âŠ”-dec l r)

    Î£-decâ†“ : âˆ€ {â„“ â„“â†“} {n : â„•} {X : ğ•† â„“ n} 
      â†’ {Xâ†“ : ğ•†â†“ â„“â†“ X} {U : â„™} {V : El U â†’ â„™}
      â†’ {Ï : (u : El U) â†’ FrmDec X (V u)}
      â†’ (Ïâ†“ : (u : El U) â†’ FrmDecâ†“ Xâ†“ (Ï u))
      â†’ FrmDecâ†“ Xâ†“ (Î£-dec Ï)

    --
    --  Application for Dependent Frame Decorations
    --
    
    appâ†“ : âˆ€ {â„“ â„“â†“} {n : â„•} {X : ğ•† â„“ n} {Xâ†“ : ğ•†â†“ â„“â†“ X}
      â†’ {P : â„™} {D : FrmDec X P}
      â†’ FrmDecâ†“ Xâ†“ D â†’ (p : El P) â†’ Frmâ†“ Xâ†“ (app D p)

    appâ†“-âŠ¤-Î² : âˆ€ {â„“ â„“â†“} {n : â„•} {X : ğ•† â„“ n} 
      â†’ {Xâ†“ : ğ•†â†“ â„“â†“ X} {f : Frm X}
      â†’ (fâ†“ : Frmâ†“ Xâ†“ f) (p : El âŠ¤â‚š)
      â†’ appâ†“ (âŠ¤-decâ†“ fâ†“) p â†¦ fâ†“
    {-# REWRITE appâ†“-âŠ¤-Î² #-}

    appâ†“-âŠ”-inl-Î² : âˆ€ {â„“ â„“â†“} {n : â„•} {X : ğ•† â„“ n} 
      â†’ {Xâ†“ : ğ•†â†“ â„“â†“ X} {U V : â„™}
      â†’ {l : FrmDec X U} {r : FrmDec X V}
      â†’ (lâ†“ : FrmDecâ†“ Xâ†“ l) (râ†“ : FrmDecâ†“ Xâ†“ r)
      â†’ (u : El U)
      â†’ appâ†“ (âŠ”-decâ†“ lâ†“ râ†“) (inlâ‚š V u) â†¦ appâ†“ lâ†“ u
    {-# REWRITE appâ†“-âŠ”-inl-Î² #-}

    appâ†“-âŠ”-inr-Î² : âˆ€ {â„“ â„“â†“} {n : â„•} {X : ğ•† â„“ n} 
      â†’ {Xâ†“ : ğ•†â†“ â„“â†“ X} {U V : â„™}
      â†’ {l : FrmDec X U} {r : FrmDec X V}
      â†’ (lâ†“ : FrmDecâ†“ Xâ†“ l) (râ†“ : FrmDecâ†“ Xâ†“ r)
      â†’ (v : El V)
      â†’ appâ†“ (âŠ”-decâ†“ lâ†“ râ†“) (inrâ‚š U v) â†¦ appâ†“ râ†“ v
    {-# REWRITE appâ†“-âŠ”-inr-Î² #-}

    appâ†“-Î£-Î² : âˆ€ {â„“ â„“â†“} {n : â„•} {X : ğ•† â„“ n} 
      â†’ {Xâ†“ : ğ•†â†“ â„“â†“ X} {U : â„™} {V : El U â†’ â„™}
      â†’ {Ï : (u : El U) â†’ FrmDec X (V u)}
      â†’ (Ïâ†“ : (u : El U) â†’ FrmDecâ†“ Xâ†“ (Ï u))
      â†’ (u : El U) (v : El (V u))
      â†’ appâ†“ (Î£-decâ†“ Ïâ†“) âŸ¦ U , V âˆ£ u , v âŸ§â‚š â†¦ appâ†“ (Ïâ†“ u) v
    {-# REWRITE appâ†“-Î£-Î² #-}

    --
    --  Laws for Dependent Frame Decorations
    --

    -- âŠ”-dec-unit-l : âˆ€ {â„“} {n : â„•} (X : ğ•† â„“ n)
    --   â†’ (V : â„™) (DV : FrmDec X V)
    --   â†’ (DâŠ¥ : FrmDec X âŠ¥â‚š)
    --   â†’ âŠ”-dec DâŠ¥ DV â†¦ DV

    -- âŠ”-dec-unit-r : âˆ€ {â„“} {n : â„•} (X : ğ•† â„“ n)
    --   â†’ (U : â„™) (DU : FrmDec X U)
    --   â†’ (DâŠ¥ : FrmDec X âŠ¥â‚š)
    --   â†’ âŠ”-dec DU DâŠ¥ â†¦ DU

    -- âŠ”-dec-assoc : âˆ€ {â„“} {n : â„•} (X : ğ•† â„“ n)
    --   â†’ (U V W : â„™)(DU : FrmDec X U)
    --   â†’ (DV : FrmDec X V) (DW : FrmDec X W)
    --   â†’ âŠ”-dec (âŠ”-dec DU DV) DW â†¦
    --     âŠ”-dec DU (âŠ”-dec DV DW)

    -- Î£-dec-unit-r : âˆ€ {â„“} {n : â„•} (X : ğ•† â„“ n)
    --   â†’ (U : â„™) (UD : FrmDec X U)
    --   â†’ Î£-dec (Î» u â†’ âŠ¤-dec (app UD u)) â†¦ UD

    -- Î£-dec-unit-l : âˆ€ {â„“} {n : â„•} (X : ğ•† â„“ n)
    --   â†’ (V : El âŠ¤â‚š â†’ â„™) (DV : (t : El âŠ¤â‚š) â†’ FrmDec X (V t))
    --   â†’ Î£-dec DV â†¦ DV ttâ‚š

    -- Î£-dec-zero-r : âˆ€ {â„“} {n : â„•} (X : ğ•† â„“ n) (U : â„™) 
    --   â†’ Î£-dec {X = X} {U = U} {V = Î» _ â†’ âŠ¥â‚š} (Î» u â†’ âŠ¥-dec) â†¦ âŠ¥-dec

    -- Î£-dec-zero-l : âˆ€ {â„“} {n : â„•} (X : ğ•† â„“ n)
    --   â†’ (V : El âŠ¥â‚š â†’ â„™)
    --   â†’ (DV : (b : El âŠ¥â‚š) â†’ FrmDec X (V b))
    --   â†’ Î£-dec DV â†¦ âŠ¥-dec
    
    -- Î£-dec-assoc : âˆ€ {â„“} {n : â„•} (X : ğ•† â„“ n)
    --   â†’ (U : â„™) (V : El U â†’ â„™)
    --   â†’ (W : El (Î£â‚š U V) â†’ â„™)
    --   â†’ (DW : (uv : El (Î£â‚š U V)) â†’ FrmDec X (W uv))
    --   â†’ Î£-dec DW â†¦ Î£-dec (Î» u â†’ Î£-dec (Î» v â†’ DW âŸ¦ U , V âˆ£ u , v âŸ§â‚š)) 

    -- âŠ”-Î£-dec-distrib-r : âˆ€ {â„“} {n : â„•} (X : ğ•† â„“ n)
    --   â†’ (U V : â„™) (W : El (U âŠ”â‚š V) â†’ â„™)
    --   â†’ (DW : (uv : El (U âŠ”â‚š V)) â†’ FrmDec X (W uv))
    --   â†’ Î£-dec DW â†¦ âŠ”-dec (Î£-dec {U = U} (Î» u â†’ DW (inlâ‚š V u)))
    --                       (Î£-dec {U = V} (Î» v â†’ DW (inrâ‚š U v)))
    
    -- âŠ”-Î£-dec-distrib-l : âˆ€ {â„“} {n : â„•} (X : ğ•† â„“ n)
    --   â†’ (U : â„™) (V : El U â†’ â„™) (W : El U â†’ â„™)
    --   â†’ (DV : (u : El U) â†’ FrmDec X (V u))
    --   â†’ (DW : (u : El U) â†’ FrmDec X (W u))
    --   â†’ Î£-dec (Î» u â†’ âŠ”-dec (DV u) (DW u)) â†¦
    --       âŠ”-dec {U = Î£â‚š U V} {V = Î£â‚š U W} (Î£-dec DV) (Î£-dec DW)


  --
  --  Dependent Constructors and Operations 
  --

  Cnsâ†“ : âˆ€ {â„“ â„“â†“} {n : â„•} {X : ğ•† â„“ n} (Xâ†“ : ğ•†â†“ â„“â†“ X)
    â†’ {f : Frm X} {P : â„™} {t : FrmDec X P} (c : Cns X f P t)
    â†’ (fâ†“ : Frmâ†“ Xâ†“ f) (tâ†“ : FrmDecâ†“ Xâ†“ t)
    â†’ Set â„“â†“

  
  record Oprâ†“ {â„“ â„“â†“} {n : â„•} {X : ğ•† â„“ n} {f : Frm X}
      (Xâ†“ : ğ•†â†“ â„“â†“ X) (fâ†“ : Frmâ†“ Xâ†“ f) (op : Opr X f) : Set â„“â†“ where
    eta-equality
    inductive
    constructor âŸª_,_âŸ«â‚’â‚šâ†“
    field
      typâ†“ : FrmDecâ†“ Xâ†“ (typ op) -- (p : El (pos op)) â†’ Frmâ†“ Xâ†“ (app (typ op) p)
      cnsâ†“ : Cnsâ†“ Xâ†“ (cns op) fâ†“ typâ†“ 

  open Oprâ†“ public

  --
  --  Higher Dependent Frames
  --

  record Frmâ†“â‚› {â„“ â„“â†“} {n : â„•} {Xâ‚™ : ğ•† â„“ n} {Xâ‚›â‚™ : Frm Xâ‚™ â†’ Set â„“} {Xâ†“â‚™ : ğ•†â†“ â„“â†“ Xâ‚™}
    (Xâ†“â‚›â‚™ : {f : Frm Xâ‚™} (fâ†“ : Frmâ†“ Xâ†“â‚™ f) (x : Xâ‚›â‚™ f) â†’ Set â„“â†“)
    {f : Frm Xâ‚™} {x : Xâ‚›â‚™ f} (fâ‚› : Frmâ‚› Xâ‚›â‚™ f x)
    (fâ†“ : Frmâ†“ Xâ†“â‚™ f) (xâ†“ : Xâ†“â‚›â‚™ fâ†“ x) : Set â„“â†“ where
    eta-equality
    inductive
    constructor âŸª_,_âŸ«fâ†“
    field
      oprâ†“ : Oprâ†“ Xâ†“â‚™ fâ†“ (opr fâ‚›)
      decâ†“ : (p : El (pos (opr fâ‚›))) â†’ Xâ†“â‚›â‚™ (appâ†“ (typâ†“ oprâ†“) p) (dec fâ‚› p)

  open Frmâ†“â‚› public
      
  --
  --  Dependent Opetopic Types 
  --
  
  ğ•†â†“ {n = O} â„“â†“ X = X â†’ Set â„“â†“
  ğ•†â†“ {n = S n} â„“â†“ (Xâ‚™ , Xâ‚›â‚™) =
    Î£ (ğ•†â†“ â„“â†“ Xâ‚™) (Î» Xâ†“â‚™ â†’
    {f : Frm Xâ‚™} (fâ†“ : Frmâ†“ Xâ†“â‚™ f) (x : Xâ‚›â‚™ f) â†’ Set â„“â†“)
  
  Frmâ†“ {n = O} {X} Xâ†“ ( x , P , t ) =
    (Xâ†“ x) Ã— ((p : El P) â†’ Xâ†“ (t p))
  Frmâ†“ {n = S n} {Xâ‚™ , Xâ‚›â‚™} (Xâ†“â‚™ , Xâ†“â‚›â‚™) (f , x , fâ‚›) =
    Î£ (Frmâ†“ Xâ†“â‚™ f) (Î» fâ†“ â†’
    Î£ (Xâ†“â‚›â‚™ fâ†“ x) (Î» xâ†“ â†’
    Frmâ†“â‚› Xâ†“â‚›â‚™ fâ‚› fâ†“ xâ†“))

  --
  --  Dependent Monadic Structure
  --

  -- Î·â†“-cns : âˆ€ {â„“ â„“â†“} {n : â„•} {X : ğ•† â„“ n} {Xâ†“ : ğ•†â†“ â„“â†“ X}
  --   â†’ {f : Frm X} (fâ†“ : Frmâ†“ Xâ†“ f)
  --   â†’ Cnsâ†“ Xâ†“ (Î·-cns f) fâ†“ (âŠ¤â‚š-Frmâ†“-rec fâ†“) 

  -- Î·â†“ : âˆ€ {â„“ â„“â†“} {n : â„•} {X : ğ•† â„“ n} {Xâ†“ : ğ•†â†“ â„“â†“ X}
  --   â†’ {f : Frm X} (fâ†“ : Frmâ†“ Xâ†“ f)
  --   â†’ Oprâ†“ Xâ†“ fâ†“ (Î· f)
  -- Î·â†“ fâ†“ = âŸª _ , Î·â†“-cns fâ†“ âŸ«â‚’â‚šâ†“

  -- Î·â†“-frm : âˆ€ {â„“ â„“â†“} {n : â„•} {Xâ‚™ : ğ•† â„“ n} {Xâ‚›â‚™ : Frm Xâ‚™ â†’ Set â„“}
  --   â†’ {Xâ†“â‚™ : ğ•†â†“ â„“â†“ Xâ‚™} {Xâ†“â‚›â‚™ : {f : Frm Xâ‚™} (fâ†“ : Frmâ†“ Xâ†“â‚™ f) (x : Xâ‚›â‚™ f) â†’ Set â„“â†“}
  --   â†’ {f : Frm Xâ‚™} {x : Xâ‚›â‚™ f}
  --   â†’ (fâ†“ : Frmâ†“ Xâ†“â‚™ f) (xâ†“ : Xâ†“â‚›â‚™ fâ†“ x)
  --   â†’ Frmâ†“â‚› Xâ†“â‚›â‚™ (Î·-frm f x) fâ†“ xâ†“
  -- Î·â†“-frm {Xâ‚›â‚™ = Xâ‚›â‚™} {Xâ†“â‚›â‚™ = Xâ†“â‚›â‚™} {f} {x} fâ†“ xâ†“ =
  --   âŸª Î·â†“ fâ†“ , âŠ¤â‚š-elim (Î» p â†’ Xâ†“â‚›â‚™ (typâ†“ (Î·â†“ fâ†“) p) (dec (Î·-frm {Xâ‚›â‚™ = Xâ‚›â‚™} f x) p)) xâ†“ âŸ«fâ†“ 

  -- Î¼â†“-cns : âˆ€ {â„“ â„“â†“} {n : â„•} {X : ğ•† â„“ n} {Xâ†“ : ğ•†â†“ â„“â†“ X}
  --   â†’ {f : Frm X} {c : Opr X f}
  --   â†’ {Î´ : (p : El (pos c)) â†’ Opr X (typ c p)}
  --   â†’ {fâ†“ : Frmâ†“ Xâ†“ f} (câ†“ : Oprâ†“ Xâ†“ fâ†“ c)
  --   â†’ (Î´â†“ : (p : El (pos c)) â†’ Oprâ†“ Xâ†“ (typâ†“ câ†“ p) (Î´ p))
  --   â†’ Cnsâ†“ Xâ†“ (Î¼-cns c Î´ ) fâ†“ (Î£â‚š-Frmâ†“-rec (Î» p q â†’ typâ†“ (Î´â†“ p) q)) 

  -- Î¼â†“ : âˆ€ {â„“ â„“â†“} {n : â„•} {X : ğ•† â„“ n} {Xâ†“ : ğ•†â†“ â„“â†“ X}
  --   â†’ {f : Frm X} {c : Opr X f}
  --   â†’ {Î´ : (p : El (pos c)) â†’ Opr X (typ c p)}
  --   â†’ {fâ†“ : Frmâ†“ Xâ†“ f} (câ†“ : Oprâ†“ Xâ†“ fâ†“ c)
  --   â†’ (Î´â†“ : (p : El (pos c)) â†’ Oprâ†“ Xâ†“ (typâ†“ câ†“ p) (Î´ p))
  --   â†’ Oprâ†“ Xâ†“ fâ†“ (Î¼ c Î´)
  -- Î¼â†“ câ†“ Î´â†“ =  âŸª _ , Î¼â†“-cns câ†“ Î´â†“  âŸ«â‚’â‚šâ†“ 

  -- Î¼â†“-frm : âˆ€ {â„“ â„“â†“} {n : â„•} {Xâ‚™ : ğ•† â„“ n} {Xâ‚›â‚™ : Frm Xâ‚™ â†’ Set â„“}
  --   â†’ {Xâ†“â‚™ : ğ•†â†“ â„“â†“ Xâ‚™} {Xâ†“â‚›â‚™ : {f : Frm Xâ‚™} (fâ†“ : Frmâ†“ Xâ†“â‚™ f) (x : Xâ‚›â‚™ f) â†’ Set â„“â†“}
  --   â†’ {f : Frm Xâ‚™} {x : Xâ‚›â‚™ f} {fâ‚› : Frmâ‚› Xâ‚›â‚™ f x}
  --   â†’ {Ï• : (p : El (pos (opr fâ‚›))) â†’ Frmâ‚› Xâ‚›â‚™ (typ (opr fâ‚›) p) (dec fâ‚› p)}
  --   â†’ {fâ†“ : Frmâ†“ Xâ†“â‚™ f} {xâ†“ : Xâ†“â‚›â‚™ fâ†“ x} (fâ†“â‚› : Frmâ†“â‚› Xâ†“â‚›â‚™ fâ‚› fâ†“ xâ†“)
  --   â†’ (Ï•â†“ : (p : El (pos (opr fâ‚›))) â†’ Frmâ†“â‚› Xâ†“â‚›â‚™ (Ï• p) (typâ†“ (oprâ†“ fâ†“â‚›) p) (decâ†“ fâ†“â‚› p))
  --   â†’ Frmâ†“â‚› Xâ†“â‚›â‚™ (Î¼-frm fâ‚› Ï•) fâ†“ xâ†“
  -- Î¼â†“-frm fâ†“â‚› Ï•â†“ = âŸª Î¼â†“ (oprâ†“ fâ†“â‚›) (Î» p â†’ oprâ†“ (Ï•â†“ p)) ,
  --   Î£â‚š-elim _ _ _ (Î» p q â†’ decâ†“ (Ï•â†“ p) q) âŸ«fâ†“

  -- --
  -- --  Dependent Monadic Laws
  -- --

  -- postulate

  --   Î¼â†“-unit-r : âˆ€ {â„“ â„“â†“} {n : â„•} {X : ğ•† â„“ n} {Xâ†“ : ğ•†â†“ â„“â†“ X}
  --     â†’ {f : Frm X} {c : Opr X f}
  --     â†’ {fâ†“ : Frmâ†“ Xâ†“ f} (câ†“ : Oprâ†“ Xâ†“ fâ†“ c)
  --     â†’ Î¼â†“-cns câ†“ (Î» p â†’ Î·â†“ (typâ†“ câ†“ p)) â†¦ cnsâ†“ câ†“
  --   {-# REWRITE Î¼â†“-unit-r #-}

  --   Î¼â†“-unit-l : âˆ€ {â„“ â„“â†“} {n : â„•} {X : ğ•† â„“ n} {Xâ†“ : ğ•†â†“ â„“â†“ X}
  --     â†’ {f : Frm X} {Î´ : (p : El (pos (Î· f))) â†’ Opr X (typ (Î· f) p)}
  --     â†’ (fâ†“ : Frmâ†“ Xâ†“ f) (Î´â†“ : (p : El (pos (Î· f))) â†’ Oprâ†“ Xâ†“ (typâ†“ (Î·â†“ fâ†“) p) (Î´ p))
  --     â†’ Î¼â†“-cns (Î·â†“ fâ†“) Î´â†“ â†¦ cnsâ†“ (Î´â†“ ttâ‚š)
  --   {-# REWRITE Î¼â†“-unit-l #-}

  --   Î¼â†“-assoc : âˆ€ {â„“ â„“â†“} {n : â„•} {X : ğ•† â„“ n} {Xâ†“ : ğ•†â†“ â„“â†“ X}
  --     â†’ {f : Frm X} {c : Opr X f}
  --     â†’ {Î´ : (p : El (pos c)) â†’ Opr X (typ c p)}
  --     â†’ {Îµ : (p : El (pos (Î¼ c Î´))) â†’ Opr X (typ (Î¼ c Î´) p)}
  --     â†’ {fâ†“ : Frmâ†“ Xâ†“ f} (câ†“ : Oprâ†“ Xâ†“ fâ†“ c)
  --     â†’ (Î´â†“ : (p : El (pos c)) â†’ Oprâ†“ Xâ†“ (typâ†“ câ†“ p) (Î´ p))
  --     â†’ (Îµâ†“ : (p : El (pos (Î¼ c Î´))) â†’ Oprâ†“ Xâ†“ (typâ†“ (Î¼â†“ câ†“ Î´â†“) p) (Îµ p))
  --     â†’ Î¼â†“-cns (Î¼â†“ câ†“ Î´â†“) Îµâ†“ â†¦
  --         Î¼â†“-cns câ†“ (Î» p â†’ Î¼â†“ (Î´â†“ p) (Î» q â†’ Îµâ†“ âŸ¦ pos c , (Î» p â†’ pos (Î´ p)) âˆ£ p , q âŸ§â‚š))
  --   {-# REWRITE Î¼â†“-assoc #-}

  -- --
  -- --  Dependent constructors
  -- --

  Cnsâ†“ = {!!} 
  -- Cnsâ†“ {n = O} Xâ†“ _ _ _ = âŠ¤
  -- Cnsâ†“ {n = S n} (Xâ†“â‚™ , Xâ†“â‚›â‚™) (lf f x) (fâ†“ , xâ†“ , Î·fâ†“â‚›) Ï„ =
  --   (Î·fâ†“â‚› â‰¡ Î·â†“-frm fâ†“ xâ†“) Ã—
  --   (Ï„ â‰¡ âŠ¥â‚š-Frmâ†“-rec {Xâ†“ = Xâ†“â‚™ , Xâ†“â‚›â‚™})
  -- Cnsâ†“ {n = S n} (Xâ†“â‚™ , Xâ†“â‚›â‚™) (nd x fâ‚›â‚™ Î´ Îµ) (fâ†“ , xâ†“ , Î¼fâ†“â‚›) Ï„ =
  --   Î£ (Frmâ†“â‚› Xâ†“â‚›â‚™ fâ‚›â‚™ fâ†“ xâ†“) (Î» fâ†“â‚›â‚™ â†’
  --   Î£ ((p : El (pos (opr fâ‚›â‚™))) â†’ Frmâ†“â‚› Xâ†“â‚›â‚™ (Î´ p) (typâ†“ (oprâ†“ fâ†“â‚›â‚™) p) (decâ†“ fâ†“â‚›â‚™ p)) (Î» Î´â†“ â†’
  --   Î£ ((p : El (pos (opr fâ‚›â‚™))) â†’ Oprâ†“ (Xâ†“â‚™ , Xâ†“â‚›â‚™) (typâ†“ (oprâ†“ fâ†“â‚›â‚™) p , decâ†“ fâ†“â‚›â‚™ p , Î´â†“ p) (Îµ p)) (Î» Îµâ†“ â†’ 
  --   (Î¼fâ†“â‚› â‰¡ Î¼â†“-frm fâ†“â‚›â‚™ Î´â†“) Ã—
  --   (Ï„ â‰¡ âŠ”â‚š-Frmâ†“-rec {Xâ†“ = (Xâ†“â‚™ , Xâ†“â‚›â‚™)} (âŠ¤â‚š-Frmâ†“-rec {Xâ†“ = (Xâ†“â‚™ , Xâ†“â‚›â‚™)} (fâ†“ , xâ†“ , fâ†“â‚›â‚™))
  --        (Î£â‚š-Frmâ†“-rec {Xâ†“ = (Xâ†“â‚™ , Xâ†“â‚›â‚™)} (Î» p q â†’ typâ†“ (Îµâ†“ p) q))))))

  -- --
  -- --  "Smart" Constructors for leaves and nodes
  -- --

  -- lfâ†“ : âˆ€ {â„“ â„“â†“} {n : â„•} {Xâ‚™ : ğ•† â„“ n} {Xâ‚›â‚™ : Frm Xâ‚™ â†’ Set â„“}
  --   â†’ {Xâ†“â‚™ : ğ•†â†“ â„“â†“ Xâ‚™} {Xâ†“â‚›â‚™ : {f : Frm Xâ‚™} (fâ†“ : Frmâ†“ Xâ†“â‚™ f) (x : Xâ‚›â‚™ f) â†’ Set â„“â†“}
  --   â†’ {f : Frm Xâ‚™} {x : Xâ‚›â‚™ f}
  --   â†’ (fâ†“ : Frmâ†“ Xâ†“â‚™ f) (xâ†“ : Xâ†“â‚›â‚™ fâ†“ x)
  --   â†’ Cnsâ†“ (Xâ†“â‚™ , Xâ†“â‚›â‚™) (lf f x)
  --       (fâ†“ , xâ†“ , Î·â†“-frm fâ†“ xâ†“)
  --       (âŠ¥â‚š-Frmâ†“-rec {Xâ†“ = Xâ†“â‚™ , Xâ†“â‚›â‚™})
  -- lfâ†“ fâ†“ xâ†“ = refl , refl 

  -- ndâ†“ : âˆ€ {â„“ â„“â†“} {n : â„•} {Xâ‚™ : ğ•† â„“ n} {Xâ‚›â‚™ : Frm Xâ‚™ â†’ Set â„“}
  --   â†’ {Xâ†“â‚™ : ğ•†â†“ â„“â†“ Xâ‚™} {Xâ†“â‚›â‚™ : {f : Frm Xâ‚™} (fâ†“ : Frmâ†“ Xâ†“â‚™ f) (x : Xâ‚›â‚™ f) â†’ Set â„“â†“}
  --   â†’ {fâ‚™ : Frm Xâ‚™} {x : Xâ‚›â‚™ fâ‚™} {fâ‚›â‚™ : Frmâ‚› Xâ‚›â‚™ fâ‚™ x}
  --   â†’ {Î´ : (p : El (pos (opr fâ‚›â‚™))) â†’ Frmâ‚› Xâ‚›â‚™ (typ (opr fâ‚›â‚™) p) (dec fâ‚›â‚™ p)}
  --   â†’ {Îµ : (p : El (pos (opr fâ‚›â‚™))) â†’ Opr (Xâ‚™ , Xâ‚›â‚™) (typ (opr fâ‚›â‚™) p , dec fâ‚›â‚™ p , Î´ p)}
  --   â†’ {fâ†“â‚™ : Frmâ†“ Xâ†“â‚™ fâ‚™} (xâ†“ : Xâ†“â‚›â‚™ fâ†“â‚™ x) (fâ†“â‚›â‚™ : Frmâ†“â‚› Xâ†“â‚›â‚™ fâ‚›â‚™ fâ†“â‚™ xâ†“)
  --   â†’ (Î´â†“ : (p : El (pos (opr fâ‚›â‚™))) â†’ Frmâ†“â‚› Xâ†“â‚›â‚™ (Î´ p) (typâ†“ (oprâ†“ fâ†“â‚›â‚™) p) (decâ†“ fâ†“â‚›â‚™ p))
  --   â†’ (Îµâ†“ : (p : El (pos (opr fâ‚›â‚™))) â†’ Oprâ†“ (Xâ†“â‚™ , Xâ†“â‚›â‚™) (typâ†“ (oprâ†“ fâ†“â‚›â‚™) p , decâ†“ fâ†“â‚›â‚™ p , Î´â†“ p) (Îµ p))
  --   â†’ Cnsâ†“ (Xâ†“â‚™ , Xâ†“â‚›â‚™) (nd x fâ‚›â‚™ Î´ Îµ) (fâ†“â‚™ , xâ†“ , Î¼â†“-frm fâ†“â‚›â‚™ Î´â†“)
  --       (âŠ”â‚š-Frmâ†“-rec {inlâ‚š* = âŠ¤â‚š-Frm-rec (fâ‚™ , x , fâ‚›â‚™)}
  --                    {inrâ‚š* = Î£â‚š-Frm-rec (Î» p q â†’ typ (Îµ p) q)}
  --                    (âŠ¤â‚š-Frmâ†“-rec {Xâ†“ = Xâ†“â‚™ , Xâ†“â‚›â‚™} (fâ†“â‚™ , xâ†“ , fâ†“â‚›â‚™) )
  --                    (Î£â‚š-Frmâ†“-rec {Xâ†“ = Xâ†“â‚™ , Xâ†“â‚›â‚™} (Î» p q â†’ typâ†“ (Îµâ†“ p) q)))
  -- ndâ†“ xâ†“ fâ†“â‚›â‚™ Î´â†“ Îµâ†“ = fâ†“â‚›â‚™ , Î´â†“ , Îµâ†“ , refl , refl

  -- --
  -- --  Dependent Grafting
  -- --

  -- Î³â†“-cns : âˆ€ {â„“ â„“â†“} {n : â„•} {Xâ‚™ : ğ•† â„“ n} {Xâ‚›â‚™ : Frm Xâ‚™ â†’ Set â„“}
  --   â†’ {Xâ†“â‚™ : ğ•†â†“ â„“â†“ Xâ‚™} {Xâ†“â‚›â‚™ : {f : Frm Xâ‚™} (fâ†“ : Frmâ†“ Xâ†“â‚™ f) (x : Xâ‚›â‚™ f) â†’ Set â„“â†“}
  --   â†’ {fâ‚™ : Frm Xâ‚™} {x : Xâ‚›â‚™ fâ‚™} {fâ‚›â‚™ : Frmâ‚› Xâ‚›â‚™ fâ‚™ x}
  --   â†’ {c : Opr (Xâ‚™ , Xâ‚›â‚™) (fâ‚™ , x , fâ‚›â‚™)}
  --   â†’ {Î´ : (p : El (pos (opr fâ‚›â‚™))) â†’ Frmâ‚› Xâ‚›â‚™ (typ (opr fâ‚›â‚™) p) (dec fâ‚›â‚™ p)}
  --   â†’ {Îµ : (p : El (pos (opr fâ‚›â‚™))) â†’ Opr (Xâ‚™ , Xâ‚›â‚™) (typ (opr fâ‚›â‚™) p , dec fâ‚›â‚™ p , Î´ p)}
  --   â†’ {fâ†“â‚™ : Frmâ†“ Xâ†“â‚™ fâ‚™} {xâ†“ : Xâ†“â‚›â‚™ fâ†“â‚™ x} {fâ†“â‚›â‚™ : Frmâ†“â‚› Xâ†“â‚›â‚™ fâ‚›â‚™ fâ†“â‚™ xâ†“}
  --   â†’ (câ†“ : Oprâ†“ (Xâ†“â‚™ , Xâ†“â‚›â‚™) (fâ†“â‚™ , xâ†“ , fâ†“â‚›â‚™) c)
  --   â†’ (Î´â†“ : (p : El (pos (opr fâ‚›â‚™))) â†’ Frmâ†“â‚› Xâ†“â‚›â‚™ (Î´ p) (typâ†“ (oprâ†“ fâ†“â‚›â‚™) p) (decâ†“ fâ†“â‚›â‚™ p))
  --   â†’ (Îµâ†“ : (p : El (pos (opr fâ‚›â‚™))) â†’ Oprâ†“ (Xâ†“â‚™ , Xâ†“â‚›â‚™) (typâ†“ (oprâ†“ fâ†“â‚›â‚™) p , decâ†“ fâ†“â‚›â‚™ p , Î´â†“ p) (Îµ p))
  --   â†’ Cnsâ†“ (Xâ†“â‚™ , Xâ†“â‚›â‚™) (Î³-cns c Î´ Îµ) (fâ†“â‚™ , xâ†“ , Î¼â†“-frm fâ†“â‚›â‚™ Î´â†“)
  --       (âŠ”â‚š-Frmâ†“-rec {inlâ‚š* = typ c} {inrâ‚š* = Î£â‚š-Frm-rec (Î» p q â†’ typ (Îµ p) q)}
  --         (typâ†“ câ†“) (Î£â‚š-Frmâ†“-rec {Ï = Î» p q â†’ typ (Îµ p) q} (Î» p q â†’ typâ†“ (Îµâ†“ p) q))) 

  -- --
  -- --  Dependent Monadic Implementation
  -- --

  -- Î·â†“-cns {n = O} fâ†“ = tt
  -- Î·â†“-cns {n = S n} (fâ†“ , xâ†“ , Î¼fâ†“â‚›) =
  --   ndâ†“ xâ†“ Î¼fâ†“â‚›
  --     (Î» p â†’ Î·â†“-frm (typâ†“ (oprâ†“ Î¼fâ†“â‚›) p) (decâ†“ Î¼fâ†“â‚› p))
  --     (Î» p â†’ âŸª _ , lfâ†“ (typâ†“ (oprâ†“ Î¼fâ†“â‚›) p) (decâ†“ Î¼fâ†“â‚› p) âŸ«â‚’â‚šâ†“)

  -- Î¼â†“-cns {n = O} _ _ = tt
  -- Î¼â†“-cns {n = S n} {c = âŸª _ , _ , lf f x âŸ«â‚’â‚š} {fâ†“ = fâ†“â‚™ , xâ†“ , ._} âŸª _ , (refl , refl) âŸ«â‚’â‚šâ†“ Îºâ†“ = lfâ†“ fâ†“â‚™ xâ†“ 
  -- Î¼â†“-cns {n = S n} {c = âŸª _ , _ , nd x fâ‚›â‚™ Î´ Îµ âŸ«â‚’â‚š} {fâ†“ = fâ†“â‚™ , xâ†“ , ._} âŸª _ , (fâ†“â‚›â‚™ , Î´â†“ , Îµâ†“ , refl , refl) âŸ«â‚’â‚šâ†“ Îºâ†“ =
  --   let wâ†“ = Îºâ†“ (inlâ‚š (Î£â‚š (pos (opr fâ‚›â‚™)) (Î» p â†’ pos (Îµ p))) ttâ‚š)
  --       Îºâ†“' p q = Îºâ†“ (inrâ‚š âŠ¤â‚š âŸ¦ pos (opr fâ‚›â‚™) , (Î» pâ‚ â†’ pos (Îµ pâ‚)) âˆ£ p , q âŸ§â‚š)
  --       Ï•â†“ p = Î¼â†“ (Îµâ†“ p) (Îºâ†“' p)
  --   in Î³â†“-cns wâ†“ Î´â†“ Ï•â†“ 

  -- Î³â†“-cns {c = âŸª _ , _ , lf _ _ âŸ«â‚’â‚š} âŸª _ , (refl , refl) âŸ«â‚’â‚šâ†“ Ï•â†“ Ïˆâ†“ = cnsâ†“ (Ïˆâ†“ ttâ‚š)
  -- Î³â†“-cns {c = âŸª _ , _ , nd x fâ‚›â‚™ Î´ Îµ âŸ«â‚’â‚š} {xâ†“ = xâ†“} âŸª _ , (fâ†“â‚›â‚™ , Î´â†“ , Îµâ†“ , refl , refl) âŸ«â‚’â‚šâ†“ Ï•â†“ Ïˆâ†“ =
  --   let Ï•â†“' p q = Ï•â†“ âŸ¦ pos (opr fâ‚›â‚™) , (Î» p' â†’ pos (opr (Î´ p'))) âˆ£ p , q âŸ§â‚š
  --       Ïˆâ†“' p q = Ïˆâ†“ âŸ¦ pos (opr fâ‚›â‚™) , (Î» p' â†’ pos (opr (Î´ p'))) âˆ£ p , q âŸ§â‚š
  --       Î´â†“' p = Î¼â†“-frm (Î´â†“ p) (Ï•â†“' p)
  --       Îµâ†“' p = âŸª _ , Î³â†“-cns (Îµâ†“ p) (Ï•â†“' p) (Ïˆâ†“' p) âŸ«â‚’â‚šâ†“
  --   in ndâ†“ xâ†“ fâ†“â‚›â‚™ Î´â†“' Îµâ†“'

  -- --
  -- --  Dependent Opetopic Types
  -- --

  -- record ğ•†â†“âˆ {â„“ â„“â†“} {n : â„•} {X : ğ•† â„“ n} (Xâˆ : ğ•†âˆ X) (Xâ†“ : ğ•†â†“ â„“â†“ X)  : Set (â„“-max (â„“-suc â„“) (â„“-suc â„“â†“)) where
  --   coinductive
  --   field
  --     Headâ†“ : {f : Frm X} (fâ†“ : Frmâ†“ Xâ†“ f) (x : Head Xâˆ f) â†’ Set â„“â†“
  --     Tailâ†“ : ğ•†â†“âˆ (Tail Xâˆ) (Xâ†“ , Headâ†“)

  -- open ğ•†â†“âˆ public 


