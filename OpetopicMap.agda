--
--  OpetopicMap.agda - Maps of opetopic types
--

open import Cubical.Foundations.Everything
open import Cubical.Data.Unit
open import Cubical.Data.Nat

open import Prelude
open import Opetopes
open import OpetopicType

module OpetopicMap where

  infixr 40 _â‡’_

  _â‡’_ : âˆ€ {â„“â‚€ â„“â‚ n} â†’ ğ•† â„“â‚€ n â†’ ğ•† â„“â‚ n
    â†’ Type (â„“-max â„“â‚€ â„“â‚)

  Frmâ‡’ : âˆ€ {â„“â‚€ â„“â‚ n} {X : ğ•† â„“â‚€ n} {Y : ğ•† â„“â‚ n} (Î± : X â‡’ Y)
    â†’ {o : ğ’ª n} â†’ Frm X o â†’ Frm Y o
    
  Cnsâ‡’ : âˆ€ {â„“â‚€ â„“â‚ n} {X : ğ•† â„“â‚€ n} {Y : ğ•† â„“â‚ n} (Î± : X â‡’ Y)
    â†’ {o : ğ’ª n} {Ï : ğ’« o} {f : Frm X o}
    â†’ Cns X f Ï â†’ Cns Y (Frmâ‡’ Î± f) Ï

  postulate

    Shp-Frmâ‡’ : âˆ€ {â„“â‚€ â„“â‚ n} {X : ğ•† â„“â‚€ n} {Y : ğ•† â„“â‚ n} (Î± : X â‡’ Y)
      â†’ {o : ğ’ª n} {Ï : ğ’« o} {f : Frm X o} (c : Cns X f Ï) (p : Pos Ï)
      â†’ Frmâ‡’ Î± (Shp X c p) â†¦ Shp Y (Cnsâ‡’ Î± c) p
    {-# REWRITE Shp-Frmâ‡’ #-} 

    Î·â‡’ : âˆ€ {â„“â‚€ â„“â‚ n} {X : ğ•† â„“â‚€ n} {Y : ğ•† â„“â‚ n} (Î± : X â‡’ Y)
      â†’ {o : ğ’ª n} (f : Frm X o)
      â†’ Cnsâ‡’ Î± (Î· X f) â†¦ Î· Y (Frmâ‡’ Î± f)
    {-# REWRITE Î·â‡’ #-} 

    Î¼â‡’ : âˆ€ {â„“â‚€ â„“â‚ n} {X : ğ•† â„“â‚€ n} {Y : ğ•† â„“â‚ n} (Î± : X â‡’ Y)
      â†’ {o : ğ’ª n} {f : Frm X o}
      â†’ {Ï : ğ’« o} (c : Cns X f Ï)
      â†’ {Î¹ : (p : Pos Ï) â†’ ğ’« (Typ Ï p)}
      â†’ (Îº : (p : Pos Ï) â†’ Cns X (Shp X c p) (Î¹ p))
      â†’ Cnsâ‡’ Î± (Î¼ X c Îº) â†¦ Î¼ Y (Cnsâ‡’ Î± c) (Î» p â†’ Cnsâ‡’ Î± (Îº p))
    {-# REWRITE Î¼â‡’ #-}

  module _ {â„“â‚€ â„“â‚ n} {Xâ‚™ : ğ•† â„“â‚€ n} {Yâ‚™ : ğ•† â„“â‚ n}
           (Xâ‚›â‚™ : {o : ğ’ª n} â†’ Frm Xâ‚™ o â†’ Type â„“â‚€)
           (Yâ‚›â‚™ : {o : ğ’ª n} â†’ Frm Yâ‚™ o â†’ Type â„“â‚)
           (Î±â‚™ : Xâ‚™ â‡’ Yâ‚™) (Î±â‚›â‚™ : {o : ğ’ª n} {f : Frm Xâ‚™ o} â†’ Xâ‚›â‚™ f â†’ Yâ‚›â‚™ (Frmâ‡’ Î±â‚™ f)) where

    WebFrmâ‡’ : {o : ğ’ª n} {Ï : ğ’« o}
      â†’ WebFrm Xâ‚™ Xâ‚›â‚™ o Ï â†’ WebFrm Yâ‚™ Yâ‚›â‚™ o Ï 
    WebFrmâ‡’ Ï† = âŸª Frmâ‡’ Î±â‚™ (frm Ï†) , Cnsâ‡’ Î±â‚™ (cns Ï†) ,
                  Î±â‚›â‚™ (tgt Ï†) , (Î» p â†’ Î±â‚›â‚™ (src Ï† p)) âŸ« 

    Webâ‡’ : {o : ğ’ª n} {Ï : ğ’« o}
      â†’ {Ï† : WebFrm Xâ‚™ Xâ‚›â‚™ o Ï} {Ï„ : ğ’¯r o Ï}
      â†’ Web Xâ‚™ Xâ‚›â‚™ Ï† Ï„ â†’ Web Yâ‚™ Yâ‚›â‚™ (WebFrmâ‡’ Ï†) Ï„ 
    Webâ‡’ (lf x) = lf (Î±â‚›â‚™ x)
    Webâ‡’ (nd Ï† Î¹ Îº Î´ Î½ Îµ) =
      nd (WebFrmâ‡’ Ï†) Î¹ Îº
        (Î» p â†’ Cnsâ‡’ Î±â‚™ (Î´ p))
        (Î» p q â†’ Î±â‚›â‚™ (Î½ p q))
        (Î» p â†’ Webâ‡’ (Îµ p))

  _â‡’_ {n = zero} _ _ = Lift Unit
  _â‡’_ {n = suc n} (Xâ‚™ , Xâ‚›â‚™) (Yâ‚™ , Yâ‚›â‚™) =
    Î£ (Xâ‚™ â‡’ Yâ‚™) (Î» Î± â†’
     {o : ğ’ª n} {f : Frm Xâ‚™ o}
     â†’ Xâ‚›â‚™ f â†’ Yâ‚›â‚™ (Frmâ‡’ Î± f))

  Frmâ‡’ {n = zero} Î± _ = lift tt
  Frmâ‡’ {n = suc n} {Xâ‚™ , Xâ‚›â‚™} {Yâ‚™ , Yâ‚›â‚™} (Î±â‚™ , Î±â‚›â‚™) =
    WebFrmâ‡’ Xâ‚›â‚™ Yâ‚›â‚™ Î±â‚™ Î±â‚›â‚™

  Cnsâ‡’ {n = zero} _ _ = lift tt
  Cnsâ‡’ {n = suc n} {Xâ‚™ , Xâ‚›â‚™} {Yâ‚™ , Yâ‚›â‚™} (Î±â‚™ , Î±â‚›â‚™) =
    Webâ‡’ Xâ‚›â‚™ Yâ‚›â‚™ Î±â‚™ Î±â‚›â‚™
  
  --
  --  Composition
  --

  infixr 30 _âŠš_
  
  _âŠš_ : âˆ€ {â„“â‚€ â„“â‚ â„“â‚‚ n} {X : ğ•† â„“â‚€ n} {Y : ğ•† â„“â‚ n} {Z : ğ•† â„“â‚‚ n}
    â†’ (Y â‡’ Z) â†’ (X â‡’ Y) â†’ (X â‡’ Z)

  postulate

    âŠš-Frm : âˆ€ {â„“â‚€ â„“â‚ â„“â‚‚ n} {X : ğ•† â„“â‚€ n} {Y : ğ•† â„“â‚ n} {Z : ğ•† â„“â‚‚ n}
      â†’ (Î± : Y â‡’ Z) (Î² : X â‡’ Y) (o : ğ’ª n) (f : Frm X o)
      â†’ Frmâ‡’ (Î± âŠš Î²) f â†¦ Frmâ‡’ Î± (Frmâ‡’ Î² f)
    {-# REWRITE âŠš-Frm #-}

    âŠš-assoc : âˆ€ {â„“â‚€ â„“â‚ â„“â‚‚ â„“â‚ƒ n}
      â†’ {X : ğ•† â„“â‚€ n} {Y : ğ•† â„“â‚ n} {Z : ğ•† â„“â‚‚ n} {W : ğ•† â„“â‚ƒ n}
      â†’ (Î± : Z â‡’ W) (Î² : Y â‡’ Z) (Î³ : X â‡’ Y)
      â†’ (Î± âŠš Î²) âŠš Î³ â†¦ Î± âŠš Î² âŠš Î³
    {-# REWRITE âŠš-assoc #-}

    -- And unit laws ...

  _âŠš_ {n = zero} Î± Î² = lift tt
  _âŠš_ {n = suc n} {Xâ‚™ , Xâ‚›â‚™} {Yâ‚™ , Yâ‚›â‚™} {Zâ‚™ , Zâ‚›â‚™} (Î±â‚™ , Î±â‚›â‚™) (Î²â‚™ , Î²â‚›â‚™) =
    Î±â‚™ âŠš Î²â‚™ , Î» x â†’ Î±â‚›â‚™ (Î²â‚›â‚™ x)

  --
  -- Equality of functions
  --
  
  -- _â‡’-â‰¡_ : âˆ€ {â„“â‚€ â„“â‚ n} {X : ğ•† â„“â‚€ n} {Y : ğ•† â„“â‚ n} 
  --   â†’ (X â‡’ Y) â†’ (X â‡’ Y) â†’ Type (â„“-max â„“â‚€ â„“â‚)

  -- postulate
  
  --   â‡’-â‰¡-to-â‰¡ : âˆ€ {â„“â‚€ â„“â‚ n} {X : ğ•† â„“â‚€ n} {Y : ğ•† â„“â‚ n} 
  --     â†’ (Î± : X â‡’ Y) (Î² : X â‡’ Y)
  --     â†’ Î± â‡’-â‰¡ Î² â†’ Î± â‰¡ Î²

  -- _â‡’-â‰¡_ {n = O} {X} {Y} Î± Î² = âŠ¤
  -- _â‡’-â‰¡_ {n = S n} {Xâ‚™ , Xâ‚›â‚™} {Yâ‚™ , Yâ‚›â‚™} (Î±â‚™ , Î±â‚›â‚™) (Î²â‚™ , Î²â‚›â‚™) =
  --   Î£ (Î±â‚™ â‡’-â‰¡ Î²â‚™) (Î» e â†’ {o : ğ’ª n} {f : Frm Xâ‚™ o}
  --     (x : Xâ‚›â‚™ f) â†’ Î±â‚›â‚™ x â‰¡ Î²â‚›â‚™ x [ (Î» Ï• â†’ Yâ‚›â‚™ (Frmâ‡’ Ï• f)) â†“ â‡’-â‰¡-to-â‰¡ Î±â‚™ Î²â‚™ e ] )

  -- -- And this last thing is by fun-ext.
  -- -- â‡’-â‰¡-to-â‰¡ {n = O} {X} {Y} Î± Î² e = refl
  -- -- â‡’-â‰¡-to-â‰¡ {n = S n} {Xâ‚™ , Xâ‚›â‚™} {Yâ‚™ , Yâ‚›â‚™} (Î±â‚™ , Î±â‚›â‚™) (Î²â‚™ , Î²â‚›â‚™) (eâ‚™ , eâ‚›â‚™) =
  -- --   po-to-Î£ (â‡’-â‰¡-to-â‰¡ Î±â‚™ Î²â‚™ eâ‚™) {!!}

