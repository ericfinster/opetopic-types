--
--  FibrantReplacement.agda - Consructing the Fibrant Replacement of an Opetopic Type
--

open import Cubical.Foundations.Everything
open import Cubical.Data.Sigma
open import Cubical.Data.Nat 

open import Core.OpetopicType
open import Core.OpetopicMap

open import Lib.Structures

module Lib.FibrantReplacement where

  --
  --  The free groupoid generated by an opetopic type
  --

  FreeGrp : âˆ€ {â„“} (X : ğ•†Typeâˆ {â„“ = â„“} tt*) (n : â„•) â†’ ğ•†Type n â„“ 

  data FreeCell {â„“} (X : ğ•†Typeâˆ {â„“ = â„“} tt*) : {n : â„•} (f : Frm (FreeGrp X n)) â†’ Type â„“ 

  FreeInc : âˆ€ {â„“} (X : ğ•†Typeâˆ {â„“ = â„“} tt*)
    â†’ (n : â„•) â†’ Skeleton X n â‡’ FreeGrp X n 

  FreeGrp X zero = tt*
  FreeGrp X (suc n) = FreeGrp X n , FreeCell X

  data FreeCell {â„“} X where

    free-in : {n : â„•} {f : Frm (Skeleton X n)}
      â†’ (x : Fill (SkeletonExt X n) f)
      â†’ FreeCell X (Frmâ‡’ (FreeInc X n) f)

    free-comp : {n : â„•} 
      â†’ {f : Frm (FreeGrp X n)}
      â†’ (s : Src (FreeCell X) f)
      â†’ FreeCell X f 

    free-fill : {n : â„•} 
      â†’ {f : Frm (FreeGrp X n)}
      â†’ (s : Src (FreeCell X) f)
      â†’ FreeCell X {suc n} (f , s , free-comp s)

    free-comp-unique : {n : â„•} 
      â†’ {f : Frm (FreeGrp X n)}
      â†’ (s : Src (FreeCell X) f)
      â†’ (t : FreeCell X f) (c : FreeCell X (f , s , t))
      â†’ free-comp s â‰¡ t

    free-fill-unique : {n : â„•} 
      â†’ {f : Frm (FreeGrp X n)}
      â†’ (s : Src (FreeCell X) f)
      â†’ (t : FreeCell X f) (c : FreeCell X (f , s , t))
      â†’ (Î» i â†’ FreeCell X (f , s , free-comp-unique s t c i))
          [ free-fill s â‰¡ c ] 

  FreeInc X zero = tt*
  FreeInc X (suc n) = FreeInc X n , free-in
